# The main entry point of your workflow.
# After configuring, running snakemake -n in a clone of this repository should successfully execute a dry-run of the workflow.
import itertools
import os 
import glob
import sys
import pandas as pd

configfile: "../config/config.yaml"
include: "rules/common.smk"
include: "rules/metagenomics.smk"
include: "rules/bin_assembly.smk"
include: "rules/single_sample_binning.smk"

rule all:
    input:
        "../results/allDatasets/metaphlan/abundance_heatmap_species.allDatasets.png",
        "../results/allDatasets/metaphlan/abundance_heatmap_genus.allDatasets.png", # hclust genus 
        "../results/allDatasets/coassembly/quast/report.html",
        expand("../results/{dataset}/assembly/quast/{sample}_quast/report.html",
            zip, sample=samples["sample"], dataset=samples["dataset"]),
        "../results/allDatasets/single_sample_assemblies/allSamples.megahit_g1000.fa", # merged clean monoassemblies
        "../results/allDatasets/single_sample_assemblies/quast/monoassemblies_quast/report.html",
        "../results/allDatasets/single_sample_assemblies/metabat2/bins/bin.1.fa", # binned_contigs 
        "../results/allDatasets/single_sample_assemblies/metabat2/plots/bin_qa_plot.png",
        expand("../results/{dataset}/assembly/megahit_g1000/metabat2/checkm/{sample}/{sample}_checkm_output.txt",
            zip, sample=samples["sample"], dataset=samples["dataset"])


# Make report for snakemake. 

report: "report/workflow.rst"
